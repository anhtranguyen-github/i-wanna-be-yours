2025-12-29 12:48:26,846 INFO hanachan.memory : Initializing MemoryManager Singleton...
2025-12-29 12:48:26,859 INFO hanachan.memory : MemoryManager: Background queue initialized.
2025-12-29 12:48:49,338 INFO memory.episodic : Connecting to Qdrant at localhost (127.0.0.1):6333
2025-12-29 12:48:49,830 INFO httpx : HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-12-29 12:48:49,860 INFO httpx : HTTP Request: GET http://127.0.0.1:6333/collections "HTTP/1.1 200 OK"
2025-12-29 12:48:49,884 INFO httpx : HTTP Request: GET http://127.0.0.1:6333/collections/episodic_memory "HTTP/1.1 200 OK"
2025-12-29 12:48:50,718 INFO httpx : HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-12-29 12:48:51,679 INFO memory.episodic : Connecting to Qdrant at localhost (127.0.0.1):6333
2025-12-29 12:48:52,118 INFO httpx : HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-12-29 12:48:52,155 INFO httpx : HTTP Request: GET http://127.0.0.1:6333/collections "HTTP/1.1 200 OK"
2025-12-29 12:48:52,181 INFO httpx : HTTP Request: GET http://127.0.0.1:6333/collections/resource_vectors "HTTP/1.1 200 OK"
2025-12-29 12:48:52,695 INFO httpx : HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-12-29 12:48:56,895 INFO hanachan.memory : MemoryManager: Live memory services are active.
2025-12-29 12:48:56,896 INFO services.llm_factory : ModelFactory: Using OpenAI (gpt-4-turbo)
2025-12-29 12:48:57,139 INFO services.llm_factory : ModelFactory: Using OpenAI (gpt-4-turbo)
2025-12-29 12:48:57,644 INFO httpx : HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-12-29 12:48:57,690 INFO httpx : HTTP Request: POST http://127.0.0.1:6333/collections/episodic_memory/points/query "HTTP/1.1 200 OK"
2025-12-29 12:48:57,697 ERROR hanachan.services.study : Failed to fetch daily goals for recalibrate-test-user: 'list' object has no attribute 'get'
2025-12-29 12:48:57,704 INFO hanachan.memory : MemoryManager: Retrieval completed in 0.54s for user recalibrate-test-user
2025-12-29 12:48:59,261 INFO httpx : HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29 12:48:59,271 INFO agent.core_agent : üõ†Ô∏è [Agent] Executing tool: generate_suggested_goals
2025-12-29 12:49:02,184 INFO httpx : HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29 12:49:02,262 INFO hanachan.memory : MemoryManager: Enqueued background task 5114ac13-74c9-432b-9717-24cf4393ca0f for session recalibrate-session
2025-12-29 12:49:02,635 INFO httpx : HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-12-29 12:49:02,690 INFO httpx : HTTP Request: POST http://127.0.0.1:6333/collections/episodic_memory/points/query "HTTP/1.1 200 OK"
2025-12-29 12:49:02,696 ERROR hanachan.services.study : Failed to fetch daily goals for recalibrate-test-user: 'list' object has no attribute 'get'
2025-12-29 12:49:02,701 INFO hanachan.memory : MemoryManager: Retrieval completed in 0.44s for user recalibrate-test-user
2025-12-29 12:49:04,186 INFO httpx : HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29 12:49:04,189 INFO agent.core_agent : üõ†Ô∏è [Agent] Executing tool: recalibrate_study_priorities
2025-12-29 12:49:04,191 ERROR agent.core_agent : Tool execution failed (recalibrate_study_priorities): 1 validation error for recalibrate_study_priorities
adjustments
  Field required [type=missing, input_value={'user_id': 'recalibrate-...icles', 'passive_form']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
2025-12-29 12:49:06,419 INFO httpx : HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29 12:49:06,423 INFO hanachan.memory : MemoryManager: Enqueued background task 122dc421-e8ad-4860-9213-4efb35a97d1a for session recalibrate-session
F
======================================================================
FAIL: test_recalibration_workflow (__main__.TestMemoryRecalibrationWorkflow.test_recalibration_workflow)
Verify that the agent:
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/tra01/OneDrive/Desktop/Last dance/hanabira.org/backend/hanachan/test/workflows/workflow_memory_recalibration.py", line 112, in test_recalibration_workflow
    self.assertTrue(batch_call_found, "Expected a POST call to /batch for recalibration")
AssertionError: False is not true : Expected a POST call to /batch for recalibration

----------------------------------------------------------------------
Ran 1 test in 40.975s

FAILED (failures=1)

--- PHASE 1: Identifying Struggles ---
ü§ñ Agent: Today, let's focus on strengthening some of the areas where you've faced challenges. Here‚Äôs your study plan:

1. **Intensive Review of Particles Logic**: We'll dive deep into understanding how particles function in sentences, which is crucial for your fluency.
2. **Complete 1 Practice Quiz**: Aim for a score of over 80%. This will help reinforce your understanding and measure your progress.
3. **Review 5 Kanji**: Focus on the kanji that have been tricky for you in the past. 

Would you like to start with a quiz on particles, or would you prefer to jump into a review session on kanji?

--- PHASE 2: Recalibrating ---
ü§ñ Agent: It seems I need a bit more information to update your study plan properly. Let me adjust the focus areas for your plan. Could you please tell me if there are any specific goals or activities you'd like to include or prioritize along with particles and passive forms? For example, would you like more quizzes, flashcards, or perhaps specific reading exercises?
