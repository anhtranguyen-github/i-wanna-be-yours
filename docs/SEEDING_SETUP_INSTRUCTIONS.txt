Hanabira.org - Dictionary Setup & Seeding Instructions
=====================================================

Prerequisites
- Docker and Docker Compose installed
- Ports in use: 5100 (Flask), 5200 (Dictionary), 8000 (Express), 3000 (Frontend), 8888 (Nginx), 27017 (MongoDB inside containers)
- Internet access to download JMDICT files

1) Start the stack
- From repo root:
  docker-compose up -d

2) Verify containers
- Check running services:
  docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Ports}}"
- Expected: hanabiraorg-dictionary-db-1, hanabiraorg-express-db-1, hanabiraorg-flask-dynamic-db-1, hanabiraorg-frontend-next-1, hanabiraorg-nginx-1

3) Seed JMDICT (dictionary database)
- Navigate to dictionary backend:
  cd backend/dictionary
- Download JMDICT (English):
  wget -O jmdict_english.zip "https://github.com/themoeway/jmdict-yomitan/releases/latest/download/jmdict_english.zip"
- Extract (use Python if unzip not installed):
  python3 -c "import zipfile; zipfile.ZipFile('jmdict_english.zip').extractall('jmdict_temp')"
- Move files into input dir:
  mv jmdict_temp/* jmdict_json_data/ && rmdir jmdict_temp
- Copy data into the dictionary container:
  docker cp jmdict_json_data hanabiraorg-dictionary-db-1:/app/
- Generate simplified JSON inside the container:
  docker exec hanabiraorg-dictionary-db-1 node /app/streamline_jmdict_json.js
- Seed to MongoDB (jmdictDatabase):
  docker exec hanabiraorg-dictionary-db-1 node /app/seed_jmdict_data.js
- Verify count:
  docker exec hanabiraorg-dictionary-db-1 mongosh jmdictDatabase --quiet --eval "db.entries.countDocuments()"

4) Verify Express static DB (zenRelationshipsAutomated)
- Check collection counts:
  docker exec hanabiraorg-express-db-1 mongosh zenRelationshipsAutomated --quiet --eval "db.getCollectionNames().forEach(function(c){print(c+': '+db[c].countDocuments())})"
- Typical counts (example):
  kanji ≈ 345, tanoswords ≈ 59276, sentences ≈ 5281, grammars ≈ 828, reading ≈ 10

5) Basic API checks
- Dictionary health (Express/Dictionary services are proxied by Nginx):
  curl -s http://localhost:5200/health || true
- Static kanji sample (Express):
  curl -s "http://localhost:8000/e-api/v1/kanji?p_tag=JLPT_N3&s_tag=part_1" | head -200

6) Optional: Dynamic Flask checks
- Flask health:
  curl -s http://localhost:5100/health || true
- Example clone (requires static DB running):
  curl -X POST http://localhost:5100/f-api/v1/clone-static-collection-kanji \
    -H "Content-Type: application/json" \
    -d '{"userId": "testUser", "collection": "kanji", "p_tag": "JLPT_N3"}'

7) Cleanup
- Remove downloaded ZIP after seeding:
  rm -f backend/dictionary/jmdict_english.zip

Troubleshooting
- If node not available on host, run streamline/seed commands inside the container as shown
- If counts are zero, re-run the streamline and seed commands and check logs
- Ensure jmdict_json_data_simplified contains 50+ simplified_term_bank_*.json files before seeding
