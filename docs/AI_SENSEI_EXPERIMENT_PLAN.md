# ðŸ§ª Experiment Plan: Isolated Multi-Agent Sensei (Prototype v1)

This plan focuses on an isolated development environment to benchmark specific agent behaviors before full integration. Development will occur in `/backend/hanachan/experiments/sensei_v1/`.

## Phase 1: Agent Isolation & Targeted Intelligence
**Goal**: Build three specialized agents that only "see" their relevant slice of the world. No data dumping; each agent gets a strict, mocked data-feed. 

> **Constraint**: Every agent response must be generated by a live call to **qwen3:1.7b** (Ollama). No hardcoded or simulated JSON/Text responses are allowed during testing.

### ðŸ  Shared Directory: `/backend/hanachan/experiments/sensei_v1/phase1/`

### Agent 1: The "Diagnostic Analyst"
*   **Prompt/Skill**: `skills/analyst_v1.md`
*   **Targeted Data (The "Eyes")**: ONLY the **Priority Matrix** (JSON list of Red/Yellow/Green items).
*   **Tools (The "Hands")**: 
    *   `flag_critical_gap(content_id)`: Marks an item as "Urgent Recovery."
*   **Mock Data**: `data/mock_priority_matrix.json`

### Agent 2: The "Behavioral Coach"
*   **Prompt/Skill**: `skills/coach_v1.md`
*   **Targeted Data (The "Eyes")**: ONLY the **PACT Context Logs** (Mood/Energy history).
*   **Tools (The "Hands")**:
    *   `set_session_intensity(low/med/high)`: Decides how hard today should be.
*   **Mock Data**: `data/mock_user_mood.json`

### Agent 3: The "Strategic Planner"
*   **Prompt/Skill**: `skills/planner_v1.md`
*   **Targeted Data (The "Eyes")**: ONLY the **OKR Key Results**.
*   **Tools (The "Hands")**:
    *   `suggest_milestone_adjustment()`: Proposes a deadline change.
*   **Mock Data**: `data/mock_okr_progress.json`

---

## Phase 2: Coordination & Orchestration (LangGraph)
**Goal**: Connect the isolated agents into a functional "Brain" using LangGraph. We will test how a signal from one agent influences the decision of another.

### ðŸ  Shared Directory: `/backend/hanachan/experiments/sensei_v1/phase2/`

### The Orchestration Flow (The "Handover")
1.  **Ingest Snapshot**: A central `SnapShotLoader` provides each agent with its specific mock data.
2.  **Step 1: The Analyst**: Analyzes the gap. Output: *"We have a high-priority Kanji gap."*
3.  **Step 2: The Coach**: Analyzes user capacity. Output: *"User is exhausted. Keep it light."*
4.  **Step 3: The Planner (The Synthesis)**: 
    *   *Input from Analyst*: "Kanji Gap"
    *   *Input from Coach*: "Keep it light"
    *   **Decision**: *"Instead of a full Kanji Quiz, let's just do a 5-minute 'Kanji Match' game."*

### Primary Success Metrics (The "Plumbing" First)
*   **Pipeline Smoothness**: Can we trigger a request from the Dashboard and get a streaming response from the `qwen3` model through the `hanachan` service without timeouts?
*   **Format Integrity**: Does the model strictly follow the requested JSON schema for its tools? (e.g., `flag_critical_gap` must return a valid `content_id` string).
*   **API Connectivity**: Verification that the `hanachan` agent can successfully "read" from the `study-plan-service` endpoints.

> **Note**: In this experiment, we are **not** optimizing for "clever" or "effective" teaching advice. The goal is a rock-solid data pipeline that doesn't break. 

### Validation Benchmarks
*   **JSON Schema Validation**: Use a Python validator to check if the model's output is parsable.
*   **Round-Trip Time**: measure total latency from "Request" -> "Ollama Thinking" -> "Frontend Display."
*   **State Persistence**: Verify `LangGraph` correctly remembers the `user_id` through the entire loop.

---

## Implementation Task List

1.  **Scaffolding**:
    *   [ ] Create `/backend/hanachan/experiments/sensei_v1/` structure.
    *   [ ] Create `json` mock data files for each agent.
2.  **Phase 1 Execution**:
    *   [ ] Write isolated Python classes for each Agent using LangChain.
    *   [ ] Verify each agent works in a standalone REPL/script with its mock data.
3.  **Phase 2 Execution**:
    *   [ ] Implement the `LangGraph` definition in `graph_prototype.py`.
    *   [ ] Create a CLI test script to run a full "Sensei Reasoning Loop" and output the final plan.
