version: '3.8'

services:
  frontend-next:
    image: coil/hanachan.org:frontend-next_blue
    network_mode: "bridge"
    extra_hosts:
      - "localhost:host-gateway"
      - "host.docker.internal:host-gateway"
    ports:
      - "127.0.0.1:3000:3000" # Bind to localhost only
    environment:
      GA_MEASUREMENT_ID: 'G-P4SLLVSNCX' # Google Analytics measurement ID
      #REACT_APP_HOST_IP: host.docker.internal # ${HOST_IP}
      REACT_APP_HOST_IP: 'express-db'
        #    depends_on:
        # - express-db
        #- flask-dynamic-db
        #- dictionary-db
    restart: unless-stopped
    networks:
      - hanachan-network

  express-db:
    image: coil/hanachan.org:express-db_blue
    network_mode: "bridge"
    extra_hosts:
      - "localhost:host-gateway"
      - "host.docker.internal:host-gateway"
    ports:
      - "127.0.0.1:8000:8000" # Bind to localhost only
    environment:
      # REACT_APP_HOST_IP: host.docker.internal # ${HOST_IP}
      REACT_APP_HOST_IP: 'express-db'
    restart: unless-stopped
    networks:
      - hanachan-network

  flask-dynamic-db:
    image: coil/hanachan.org:flask-dynamic-db_blue
    network_mode: "bridge"
    extra_hosts:
      - "localhost:host-gateway"
      - "host.docker.internal:host-gateway"
    volumes:
      - /opt/data/user_db:/data/db
    ports:
      - "127.0.0.1:5100:5100" # Bind to localhost only
    restart: unless-stopped
    networks:
      - hanachan-network

  dictionary-db:
    image: coil/hanachan.org:dictionary-db_blue
    network_mode: "bridge"
    extra_hosts:
      - "localhost:host-gateway"
      - "host.docker.internal:host-gateway"
    volumes:
      - './config_dummy.json:/app/config.json'
    ports:
      - "127.0.0.1:5200:5200" # Bind to localhost only
    restart: unless-stopped
    networks:
      - hanachan-network

volumes:
  user_db:


networks:
  hanachan-network:
